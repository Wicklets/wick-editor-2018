<!DOCTYPE html>
<html>

<head>
	<title>Wick Editor</title>

	<link rel="stylesheet" type="text/css" href="editor.css">

	<script src="lib/jquery.min.js"></script>
	<script src="lib/fabric.js"></script>
	<script src="lib/fabric.canvasex.js"></script>
	<script src="lib/verboselog.js"></script>
	<script src="lib/beautify.js"></script>
	<script src="lib/ace/ace.js" type="text/javascript" charset="utf-8"></script>
	<script src="lib/paper-core.min.js" type="text/javascript"></script>
	<script src="lib/FileSaver.min.js"></script>
	<script src="lib/fpscounter.js"></script>
	<script src="lib/browserdetection.js"></script>
	
	<script src="src/wickfileutils.js"></script>
	<script src="src/wickobjectutils.js"></script>
	<script src="src/wicksharedutils.js"></script>
	<script src="src/wickframe.js"></script>
	<script src="src/wickobject.js"></script>
	<script src="src/wickproject.js"></script>
	<script src="src/wickfabriccanvas.js"></script>
	<script src="src/wickpapercanvas.js"></script>
	<script src="src/wickhtmlguihandler.js"></script>
	<script src="src/wickscriptingide.js"></script>
	<script src="src/wickactions.js"></script>

	<script src="src/wickeditor.js"></script>
	<script src="src/wickplayer.js"></script>

	<!-- Set everything up inside this function -->
	<script>
	$(document).ready(function() { 
		wickEditor = new WickEditor();

		document.addEventListener( 'mousemove', function(e) { 
			wickEditor.updateMousePosition(e) 
		}, false );

		document.addEventListener('contextmenu', function (event) { 
			event.preventDefault();
		}, false);

		document.body.addEventListener("keydown", function (event) {
			wickEditor.handleKeyboardInput("keydown", event);
		});

		document.body.addEventListener("keyup", function (event) {
			wickEditor.handleKeyboardInput("keyup", event);
		});

		window.addEventListener('resize', function(e) {
			wickEditor.resizeCanvasAndGUI(e); 
		}, false);
		wickEditor.resizeCanvasAndGUI();

		window.addEventListener("beforeunload", function (event) {
			var confirmationMessage = 'Warning: All unsaved changes will be lost!';
			(event || window.event).returnValue = confirmationMessage; //Gecko + IE
			return confirmationMessage; //Gecko + Webkit, Safari, Chrome etc.
		});

		var focusHiddenArea = function () {
			// In order to ensure that the browser will fire clipboard events, we always need to have something selected
			if($("#scriptingGUI").css('visibility') === 'hidden') {
				$("#hidden-input").val(' ');
				$("#hidden-input").focus().select();
			}
		}

		document.addEventListener("copy", function(event) {

			wickEditor.clearKeys();

			if(document.activeElement.nodeName != 'TEXTAREA' ) {
				focusHiddenArea();
				wickEditor.handleCopyEvent(event);
			}
		});

		document.addEventListener("paste", function(event) {

			wickEditor.clearKeys();

			if(document.activeElement.nodeName != 'TEXTAREA' ) {
				focusHiddenArea();
				wickEditor.importFilesPastedIntoEditor(event);
			}
		});

		$("#editorCanvasContainer").on('drop', function(e) {
			// prevent browser from opening the file
			e.stopPropagation();
			e.preventDefault();

			wickEditor.importFilesDroppedIntoEditor(e.originalEvent.dataTransfer.files);

			return false;
		});

		event.preventDefault();
	});
	</script>
</head>

<body>

<!-- Hidden element to always be selected so browser always fires copy/paste events -->

	<input id="hidden-input" class="hidden" type="text" value="" />

<!-- Editor GUI, visible when a project is being edited & not running -->

	<div id="editor">
		<div tabindex="1" id="editorCanvasContainer">
			<canvas id="editorCanvas"></canvas>
		</div>

	<!-- Main menu GUI, top left corner -->

		<div id="menuBarGUI" class="GUIBox">
			<strong>Wick Editor</strong><br />

			<hr />
			<div class="button buttonInRow" id="newProjectButton" onclick="wickEditor.newProject();">
				<img src="resources/trashcan.png" width="30" />
			</div>	
			<div class="button buttonInRow" id="exportJSONButton" onclick="wickEditor.saveProject();">
				<img src="resources/save.png" width="30" />
			</div>
			<div class="button buttonInRow" id="openProjectButton" onclick="$('#importButton').click();">
				<img src="resources/open-folder.png" width="30" />
			</div>
			<div class="button buttonInRow" id="exportHTMLButton" onclick="wickEditor.exportProject();">
				<img src="resources/export.png" width="30" />
			</div>
			<div class="button buttonInRow" id="runButton" onclick="wickEditor.runProject();">
				<img src="resources/play.png" width="30" />
			</div>

			<!-- Hidden, gets clicked automatically by openProjectButton -->
			<input type="file" id="importButton" onchange="wickEditor.openProject();" /> 
		</div>

	<!-- Timeline GUI, centered at the top of the screen -->

		<div id="timelineGUI" class="GUIBox">
			<div class="button buttonInRow" id="addEmptyFrameButton" onclick="wickEditor.actionHandler.doAction('addEmptyFrame', []);">
				<img src="resources/ic_add_black.png" width="10" />
			</div>
			<div class="button buttonInRow" id="extendFrameButton" onclick="
			    wickEditor.actionHandler.doAction('shrinkFrame', []);">
				<img src="resources/ic_keyboard_arrow_left.png" width="10" />
			</div>
			<div class="button buttonInRow" id="shrinkFrameButton" onclick="
			    wickEditor.actionHandler.doAction('extendFrame', []);">
				<img src="resources/ic_keyboard_arrow_right.png" width="10" />
			</div>
			<div id="timelineScrollContainer">
				<div id="timeline">
					<!-- Populated with 'timelineFrame' divs by editor. -->
				</div>
			</div>
		</div>

	<!-- Toolbar GUI, centered at the left side of the screen -->

		<div id="toolbarGUI" class="GUIBox">
			<div class="button" id="mouseToolButton" onclick="wickEditor.stopDrawingMode();">
				<img src="resources/cursor.png" width="30"></img>
			</div>
			<hr />

			<div class="button" id="paintbrushToolButton" onclick="wickEditor.startDrawingMode();">
				<img src="resources/paintbrush.png" width="30"></img>
			</div>
			<div id="toolOptions">
				Line Width: <input type="range" value="8" min="0" max="150" id="lineWidth"><br />
				Line Color: <input type="color" value="#b060b0" id="lineColor">
			</div>
			<hr />

			<div class="button" id="textToolButton" onclick="wickEditor.addNewText('Click to edit text');">
				<img src="resources/text.png" width="30"></img>
			</div>
			<hr />

			<div class="button" id="htmlSnippetToolButton" onclick="wickEditor.addNewHTMLSnippet();">
				<img src="resources/htmlsnippet.png" width="30"></img>
			</div>

		</div>

	<!-- WickObject Scripting GUI, bottom left corner -->

		<div id="scriptingGUI" class="GUIBox">
			<div class="elemInRow">
				<div class="button buttonInRow" id="onLoadButton">onLoad</div>
				<div class="button buttonInRow" id="onClickButton">onClick</div>
				<div class="button buttonInRow" id="onUpdateButton">onUpdate</div>
				<div class="button buttonInRow" id="onKeyDownButton">onKeyDown</div>
				<div class="button buttonInRow" id="beautifyButton"><font color="orange">Beautify</font></div>
				<div class="button buttonInRow" id="closeScriptingGUIButton"><font color="red">Close</font></div>
				<br />
				<div id="scriptEditor"></div>
			</div>
			<div class="elemInRow">
				<u>Script References</u>
				<div class="button" draggable=true id="refBtnPlay">play</div>
				<div class="button" draggable=true id="refBtnStop">stop</div>
				<div class="button" draggable=true id="refBtnGotoAndStop">gotoAndStop</div>
				<div class="button" draggable=true id="refBtnGotoAndPlay">gotoAndPlay</div>
				<div class="button" draggable=true id="refBtnGotoNextFrame">gotoNextFrame</div>
				<div class="button" draggable=true id="refBtnGotoPrevFrame">gotoPrevFrame</div>
			</div>
		</div>

	<!-- Properties GUI, bottom right corner -->

		<div id="propertiesGUI" class="GUIBox">
			<div id="projectProperties">
				Project Properties
				<hr />
				Background color: <input type="color" value="#FFFFFF" id="projectBgColor"><br />
				Size: <textarea id="projectSizeX" cols="4" rows="1"></textarea> x 
				      <textarea id="projectSizeY" cols="4" rows="1"></textarea><br />
				Framerate: <textarea id="frameRate" cols="2" rows="1"></textarea><br />
				<input type="checkbox" id="fitScreenCheckbox" checked> Fit to Screen Size
			</div>
			<div id="objectProperties">
				Object Properties
				<hr />
				Opacity: <input type="range" value="255" min="0" max="255" id="opacitySlider">
				<br />
				Name: <textarea id="objectName" cols="18" rows="1"></textarea><br />
			</div>
			<div id="textProperties">
				Text Properties
				<hr />
				Font: <select id="fontSelector">
					<option value="Georgia">Georgia</option>
					<option value="Palatino Linotype">Palatino Linotype</option>
					<option value="Book Antiqua">Book Antiqua</option>
					<option value="Times New Roman">Times New Roman</option>
					<option value="Arial" selected>Arial</option>
					<option value="Helvetica">Helvetica</option>
					<option value="Arial Black">Arial Black</option>
					<option value="Comic Sans MS">Comic Sans MS</option>
					<option value="Impact">Impact</option>
					<option value="Lucida Sans Unicode">Lucida Sans Unicode</option>
					<option value="Tahoma">Tahoma</option>
					<option value="Geneva">Geneva</option>
					<option value="Trebuchet MS">Trebuchet MS</option>
					<option value="Verdana">Verdana</option>
					<option value="Courier New">Courier New</option>
					<option value="Lucida Console">Lucida Console</option>
				</select><br />
				Color: <input type="color" value="#FFFFFF" id="fontColor"><br />
				Size: <input type="range" value="40" min="2" max="150" id="fontSize"><br />
			</div>
			<div id="htmlSnippetProperties">
				HTML Snippet Properties
				<hr />
				HTML: <textarea id="htmlTextBox"></textarea><br />
			</div>
		</div>

	<!-- Right click menu, appears next to mouse on right click -->

		<div id="rightClickMenu" class="GUIBox">
			<div id="commonObjectButtons">
				<div class="button" onclick="wickEditor.htmlGUIHandler.closeRightClickMenu();wickEditor.editScriptsOfSelectedObject();" >Edit Scripts</div>
				<hr />
				<div class="button" onclick="wickEditor.htmlGUIHandler.closeRightClickMenu();wickEditor.bringSelectedObjectToFront();" >Bring to Front</div>
				<div class="button" onclick="wickEditor.htmlGUIHandler.closeRightClickMenu();wickEditor.sendSelectedObjectToBack();" >Send to Back</div>
				<div class="button" onclick="wickEditor.htmlGUIHandler.closeRightClickMenu();wickEditor.deleteSelectedObjects();" >Delete</div>
				<hr />
			</div>
			<div id="symbolButtons">
				<div class="button" onclick="wickEditor.htmlGUIHandler.closeRightClickMenu();wickEditor.editSelectedObject();" >Edit Object</div>
				<hr />
			</div>
			<div id="staticObjectButtons">
				<div class="button" onclick="wickEditor.htmlGUIHandler.closeRightClickMenu();wickEditor.convertSelectedObjectToSymbol();" >Convert to Symbol</div>
				<hr />
			</div>
			<div id="insideSymbolButtons">
				<div class="button" onclick="wickEditor.htmlGUIHandler.closeRightClickMenu();wickEditor.finishEditingObject();" >Finish Editing Object</div>
			</div>
			<div id="frameButtons">
				<div class="button" onclick="wickEditor.htmlGUIHandler.closeRightClickMenu();wickEditor.clearFrame();" >Clear Frame</div>
			</div>
		</div>

	</div>

<!-- Builtin player, visible when a project is running -->

	<div id="builtinPlayer">
		<div id="playerCanvasContainer">
			<canvas id="playerCanvas"></canvas>
		</div>

		<div id="builtinPlayerGUI" class="GUIBox">
			<strong>Builtin Player</strong><br />
			<hr />
			<div class="button" id="closeBuiltinPlayerButton" onclick="wickEditor.closeBuiltinPlayer();">Close Player</div>
		</div>
	</div>

</body>

</html>
